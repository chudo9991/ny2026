<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –ï–ª–∫–∞ - –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        #ui-overlay button {
            pointer-events: all !important;
            z-index: 1000 !important;
        }

        #container {
            cursor: pointer;
        }

        #start-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            pointer-events: all;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        #start-button:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
        }

        #instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            text-align: center;
            font-size: 14px;
            pointer-events: all;
            max-width: 90%;
            z-index: 10;
        }

        #mobile-instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            text-align: center;
            font-size: 14px;
            pointer-events: all;
            max-width: 90%;
            z-index: 10;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            #instructions {
                display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            }
            
            #mobile-instructions {
                display: block; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
            }
        }

        .hidden {
            display: none !important;
        }

        #status {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            pointer-events: all;
        }
    </style>
</head>
<body>
    <div id="container">
        <video id="video" autoplay muted playsinline></video>
        <canvas id="canvas"></canvas>
        
        <div id="ui-overlay">
            <button id="start-button">üéÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
            <button id="reset-button" class="hidden" style="position: absolute; top: 20px; right: 20px; background: #ff6b6b; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: bold; z-index: 10000;">üîÑ –°–±—Ä–æ—Å</button>
            <button id="lights-button" class="hidden" style="position: absolute; top: 20px; right: 130px; background: #4ecdc4; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: bold; z-index: 10000;">üí° –û–≥–Ω–∏</button>
            
            <div id="status">
                <div>–°—Ç–∞—Ç—É—Å: <span id="status-text">–ì–æ—Ç–æ–≤</span></div>
            </div>
            
            <div id="instructions">
                <div>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –ø–ª–æ—Å–∫—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å</div>
                <div><strong>–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞</strong></div>
                <div style="color: #4ecdc4; font-size: 12px; margin-top: 5px;">
                    üí° –ü–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è: –∫–ª–∏–∫ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, –∫–æ–ª–µ—Å–æ –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞, –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ–≥–Ω–µ–π
                </div>
            </div>
            
            <!-- <div id="mobile-instructions" style="display: none;">
                <div>üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –ø–ª–æ—Å–∫—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å</div>
                <div>üéØ <strong>–¢–∞–ø–Ω–∏—Ç–µ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –µ–ª–∫–∏</strong></div>
                <div>üîÑ <strong>–¢–∞–ø–Ω–∏—Ç–µ —Å–Ω–æ–≤–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è</strong></div>
                <div>üì± <strong>Pinch-–∂–µ—Å—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞</strong></div>
                <div>üí° <strong>–ö–Ω–æ–ø–∫–∞ "–û–≥–Ω–∏" –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è</strong></div>
                <div>üéÑ –°–ª—É—á–∞–π–Ω–∞—è –º–æ–¥–µ–ª—å –∏–∑ –≤–∞—à–∏—Ö GLB —Ñ–∞–π–ª–æ–≤</div>
                <div style="color: #4ecdc4; font-size: 12px; margin-top: 5px;">
                    üí° –ü–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è: —Ç–∞–ø –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, pinch –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞, –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ–≥–Ω–µ–π
                </div>
            </div> -->
            

        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- GLTFLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        class BasicARApp {
            constructor() {
                this.video = null;
                this.canvas = null;
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.treeModel = null;
                this.isARActive = false;
                this.treePlaced = false;
                this.lightsOn = true; // –û–≥–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                
                this.init();
            }

            async init() {
                this.video = document.getElementById('video');
                this.canvas = document.getElementById('canvas');
                
                this.setupEventListeners();
                this.setupResizeHandler();
                this.updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            }
            
            setupResizeHandler() {
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ –∏ –ø–æ–≤–æ—Ä–æ—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        this.handleResize();
                    }, 100);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–≤–æ—Ä–æ—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö)
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => {
                        this.handleResize();
                    }, 200);
                });
            }
            
            handleResize() {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞–º–µ—Ä—ã –∏ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
                if (this.camera && this.renderer) {
                    const canvasWidth = this.canvas.clientWidth || window.innerWidth;
                    const canvasHeight = this.canvas.clientHeight || window.innerHeight;
                    
                    this.camera.aspect = canvasWidth / canvasHeight;
                    this.camera.updateProjectionMatrix();
                    
                    this.renderer.setSize(canvasWidth, canvasHeight, false);
                    this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Å—à—Ç–∞–± –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
                    if (this.treeModel) {
                        const baseNorm = this.treeModel.userData.normScale || 1;
                        const newDeviceScale = this.getAdaptiveScale();
                        const target = baseNorm * newDeviceScale;
                        this.treeModel.userData.targetScale = target;
                        // –ï—Å–ª–∏ —É–∂–µ —Ä–∞–∑–º–µ—â–µ–Ω–æ - –ø—Ä–∏–º–µ–Ω—è–µ–º —Ü–µ–ª–µ–≤–æ–π –º–∞—Å—à—Ç–∞–±
                        if (this.treePlaced) {
                            this.treeModel.scale.set(target, target, target);
                        }
                    }
                }
            }

            setupEventListeners() {
                const startButton = document.getElementById('start-button');
                const resetButton = document.getElementById('reset-button');
                const lightsButton = document.getElementById('lights-button');
                
                if (startButton) {
                    startButton.addEventListener('click', () => {
                        this.startAR();
                    });
                }
                
                if (resetButton) {
                    resetButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.resetTree();
                    });
                }
                
                if (lightsButton) {
                    lightsButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.toggleHolidayLights();
                    });
                }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –∏ —Ç–∞–ø–æ–≤ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –µ–ª–∫–∏
            const container = document.getElementById('container');
            if (container) {
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–ª–∏–∫–æ–≤ (–¥–µ—Å–∫—Ç–æ–ø)
                container.addEventListener('click', (event) => {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º –∏ –¥—Ä—É–≥–∏–º UI —ç–ª–µ–º–µ–Ω—Ç–∞–º
                    if (event.target.tagName === 'BUTTON' || 
                        event.target.closest('button') || 
                        event.target.closest('#instructions') ||
                        event.target.closest('#mobile-instructions')) {
                        return;
                    }
                    
                    if (this.isARActive) {
                        if (!this.treePlaced) {
                            this.placeTree(event);
                        } else {
                            this.moveTree(event);
                        }
                    } else {
                        this.updateStatus('AR –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω');
                    }
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ç–∞–ø–æ–≤ (–º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
                container.addEventListener('touchstart', (event) => {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–∞–ø—ã –ø–æ –∫–Ω–æ–ø–∫–∞–º –∏ –¥—Ä—É–≥–∏–º UI —ç–ª–µ–º–µ–Ω—Ç–∞–º
                    if (event.target.tagName === 'BUTTON' || 
                        event.target.closest('button') || 
                        event.target.closest('#instructions') ||
                        event.target.closest('#mobile-instructions')) {
                        return;
                    }
                    
                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ click —Å–æ–±—ã—Ç–∏—è
                    event.preventDefault();
                    
                    if (this.isARActive) {
                        if (!this.treePlaced) {
                            this.placeTree(event);
                        } else {
                            this.moveTree(event);
                        }
                    } else {
                        this.updateStatus('AR –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω');
                    }
                }, { passive: false });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–µ—Å–∞ –º—ã—à–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –µ–ª–∫–∏
                container.addEventListener('wheel', (event) => {
                    if (this.isARActive && this.treePlaced && this.treeModel) {
                        event.preventDefault();
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                        const delta = event.deltaY > 0 ? -0.1 : 0.1;
                        
                        this.changeTreeSize(delta);
                    }
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–µ—Å—Ç–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                let initialDistance = 0;
                let initialScale = 0.3;

                container.addEventListener('touchstart', (event) => {
                    if (this.isARActive && this.treePlaced && this.treeModel && event.touches.length === 2) {
                        event.preventDefault();
                        initialDistance = Math.hypot(
                            event.touches[0].clientX - event.touches[1].clientX,
                            event.touches[0].clientY - event.touches[1].clientY
                        );
                        initialScale = this.treeModel.scale.x;
                    }
                });

                container.addEventListener('touchmove', (event) => {
                    if (this.isARActive && this.treePlaced && this.treeModel && event.touches.length === 2) {
                        event.preventDefault();
                        
                        const currentDistance = Math.hypot(
                            event.touches[0].clientX - event.touches[1].clientX,
                            event.touches[0].clientY - event.touches[1].clientY
                        );
                        
                        const scaleChange = (currentDistance - initialDistance) / 100;
                        const newScale = initialScale + scaleChange;
                        
                        this.treeModel.scale.set(newScale, newScale, newScale);
                        
                        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
                        const minScale = 0.1;
                        const maxScale = 2.0;
                        
                        this.treeModel.scale.x = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.x));
                        this.treeModel.scale.y = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.y));
                        this.treeModel.scale.z = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.z));
                        
                    }
                });
            }
            }

            async startAR() {
                try {
                    this.updateStatus('–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...');
                    
                    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        } 
                    });
                    
                    this.video.srcObject = stream;
                    
                    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
                    this.video.addEventListener('loadedmetadata', () => {
                        this.setupThreeJS();
                        this.hideStartButton();
                        this.showControlButtons();
                        this.showStatus(true);
                        this.isARActive = true;
                        this.updateStatus('AR –∞–∫—Ç–∏–≤–µ–Ω');
                    });
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
                    this.updateStatus('–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ');
                }
            }

            async setupThreeJS() {
                // –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É Three.js
                this.scene = new THREE.Scene();
                
                // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã canvas –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω
                const canvasWidth = this.canvas.clientWidth || window.innerWidth;
                const canvasHeight = this.canvas.clientHeight || window.innerHeight;
                
                // –°–æ–∑–¥–∞–µ–º –∫–∞–º–µ—Ä—É
                this.camera = new THREE.PerspectiveCamera(
                    75, 
                    canvasWidth / canvasHeight, 
                    0.1, 
                    1000
                );
                
                // –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä
                this.renderer = new THREE.WebGLRenderer({ 
                    canvas: this.canvas,
                    alpha: true,
                    antialias: true
                });
                
                this.renderer.setSize(canvasWidth, canvasHeight, false);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º GLB –º–æ–¥–µ–ª—å –µ–ª–∫–∏
                await this.createTreeFromGLB();
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Å–≤–µ—â–µ–Ω–∏–µ
                this.setupLighting();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
                this.animate();
            }

            getAdaptiveScale() {
                // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–∞—Å—à—Ç–∞–± –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —ç–∫—Ä–∞–Ω–∞
                const isMobile = window.innerWidth < 768;
                const isSmallScreen = window.innerWidth < 480;
                
                if (isSmallScreen) {
                    return 0.2; // –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã (–º–æ–±–∏–ª—å–Ω—ã–µ)
                } else if (isMobile) {
                    return 0.25; // –°—Ä–µ–¥–Ω–∏–µ –º–æ–±–∏–ª—å–Ω—ã–µ
                } else {
                    return 0.3; // –î–µ—Å–∫—Ç–æ–ø
                }
            }
            
            normalizeGLTF(scene) {
                // –°—á–∏—Ç–∞–µ–º bbox –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏
                const box = new THREE.Box3().setFromObject(scene);
                const size = box.getSize(new THREE.Vector3());
                const center = box.getCenter(new THREE.Vector3());
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ë—Ä—Ç–∫—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ü–µ–Ω—Ç—Ä–æ–º
                const wrapper = new THREE.Group();
                
                // –°–¥–≤–∏–≥–∞–µ–º –≥–µ–æ–º–µ—Ç—Ä–∏—é —Ç–∞–∫, —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä –æ–∫–∞–∑–∞–ª—Å—è –≤ (0,0,0)
                scene.position.sub(center);
                wrapper.add(scene);
                
                // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤—ã—Å–æ—Ç—É –¥–æ 1.0 –º–∏—Ä–æ–≤—ã—Ö –µ–¥–∏–Ω–∏—Ü
                const targetHeight = 1.0;
                const h = size.y || 1.0;
                const normScale = targetHeight / h;
                wrapper.scale.setScalar(normScale);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–∞—Å—à—Ç–∞–± –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                wrapper.userData.normScale = normScale;
                return wrapper;
            }

            async createTreeFromGLB() {
                return new Promise((resolve, reject) => {
                    // –†–∞–∑–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –º–æ–¥–µ–ª–µ–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ –¥–µ—Å–∫—Ç–æ–ø–∞
                    const isMobile = window.innerWidth < 768;
                    let availableModels;
                    
                    if (isMobile) {
                        // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö - —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å
                        availableModels = ['tree_3december_day_22.glb'];
                    } else {
                        // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ - –≤—Å–µ –º–æ–¥–µ–ª–∏
                        availableModels = [
                            'tree.glb',
                            'christmas_log.glb',
                            'christmas_present.glb',
                            'snow_globe.glb',
                            'tree_3december_day_22.glb'
                        ];
                    }
                    
                    // –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
                    const randomModel = availableModels[Math.floor(Math.random() * availableModels.length)];
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ, –∫–∞–∫—É—é –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ–º
                    this.updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏: ' + randomModel);
                    
                    const loader = new THREE.GLTFLoader();
                    loader.load(
                        `./${randomModel}`,
                        (gltf) => {
                            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –º–æ–¥–µ–ª—å (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ + –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä)
                            const normalized = this.normalizeGLTF(gltf.scene);
                            this.treeModel = normalized;
                            
                            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–∞—Å—à—Ç–∞–± –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                            const deviceScale = this.getAdaptiveScale();
                            this.treeModel.scale.multiplyScalar(deviceScale);
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–µ–ª–µ–≤–æ–π –º–∞—Å—à—Ç–∞–± –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
                            this.treeModel.userData.targetScale = this.treeModel.scale.x;
                            
                            this.treeModel.visible = false;
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–Ω–∏
                            this.treeModel.traverse((child) => {
                                if (child.isMesh) {
                                    child.castShadow = true;
                                    child.receiveShadow = true;
                                }
                            });
                            
                            this.scene.add(this.treeModel);
                            resolve();
                        },
                        (progress) => {
                            // Progress callback
                        },
                        (error) => {
                            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ GLB –º–æ–¥–µ–ª–∏:', error);
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                            this.updateStatus('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ' + randomModel + '. –°–æ–∑–¥–∞—ë–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –º–æ–¥–µ–ª—å...');
                            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –µ–ª–∫—É –∫–∞–∫ fallback
                            this.createSimpleTree();
                            resolve();
                        }
                    );
                });
            }

            createSimpleTree() {
                // –°—Ç–≤–æ–ª –µ–ª–∫–∏ (–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ü–∏–ª–∏–Ω–¥—Ä)
                const trunkGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.5, 8);
                const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.position.y = -0.25;
                
                // –ò–≥–æ–ª–∫–∏ –µ–ª–∫–∏ (–∑–µ–ª–µ–Ω—ã–µ –∫–æ–Ω—É—Å—ã)
                const needlesGeometry = new THREE.ConeGeometry(0.8, 1.5, 8);
                const needlesMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
                const needles = new THREE.Mesh(needlesGeometry, needlesMaterial);
                needles.position.y = 0.5;
                
                // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É –¥–ª—è –µ–ª–∫–∏
                this.treeModel = new THREE.Group();
                this.treeModel.add(trunk);
                this.treeModel.add(needles);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —É–∫—Ä–∞—à–µ–Ω–∏—è (—Ü–≤–µ—Ç–Ω—ã–µ —à–∞—Ä—ã)
                this.addDecorations();
                
                this.scene.add(this.treeModel);
                this.treeModel.visible = false;
            }

            addDecorations() {
                const colors = [0xFF0000, 0x00FF00, 0x0000FF, 0xFFFF00, 0xFF00FF, 0x00FFFF];
                
                for (let i = 0; i < 6; i++) {
                    const ballGeometry = new THREE.SphereGeometry(0.1, 8, 8);
                    const ballMaterial = new THREE.MeshLambertMaterial({ 
                        color: colors[i] 
                    });
                    const ball = new THREE.Mesh(ballGeometry, ballMaterial);
                    
                    // –°–ª—É—á–∞–π–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–∞ –µ–ª–∫–µ
                    ball.position.set(
                        (Math.random() - 0.5) * 1.2,
                        Math.random() * 1.5 - 0.5,
                        (Math.random() - 0.5) * 1.2
                    );
                    
                    this.treeModel.add(ball);
                }
            }

            setupLighting() {
                // –û–∫—Ä—É–∂–∞—é—â–∏–π —Å–≤–µ—Ç
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                this.scene.add(ambientLight);

                // –û—Å–Ω–æ–≤–Ω–æ–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–≤–µ—Ç
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);

                // –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –æ–≥–Ω–∏ –≤–æ–∫—Ä—É–≥ –µ–ª–∫–∏
                this.createHolidayLights();
            }

            createHolidayLights() {
                // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–≤–µ—Ç–∞ –ø–æ –∫—Ä—É–≥—É —Å —à–∞–≥–æ–º 15 –≥—Ä–∞–¥—É—Å–æ–≤ (24 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
                const numLights = 24; // 360 / 15 = 24 –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                
                // –¶–≤–µ—Ç–∞ –¥–ª—è –æ–≥–Ω–µ–π
                const colors = [
                    0xff4444, // –ö—Ä–∞—Å–Ω—ã–π
                    0xff8844, // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                    0xffff44, // –ñ–µ–ª—Ç—ã–π
                    0x88ff44, // –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π
                    0x44ff44, // –ó–µ–ª–µ–Ω—ã–π
                    0x44ff88, // –ú–æ—Ä—Å–∫–æ–π –≤–æ–ª–Ω—ã
                    0x44ffff, // –ì–æ–ª—É–±–æ–π
                    0x4488ff, // –°–∏–Ω–∏–π
                    0x8844ff, // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
                    0xff44ff, // –†–æ–∑–æ–≤—ã–π
                    0xff4488, // –†–æ–∑–æ–≤–æ-–∫—Ä–∞—Å–Ω—ã–π
                    0xff6666  // –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π
                ];
                
                this.holidayLights = [];

                for (let i = 0; i < numLights; i++) {
                    const color = colors[i % colors.length]; // –¶–∏–∫–ª–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç–∞
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ—Ç–∞
                    const pointLight = new THREE.PointLight(color, 1.2, 8);
                    pointLight.visible = false; // –î–µ–ª–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–º
                    pointLight.castShadow = true;
                    this.scene.add(pointLight);
                    this.holidayLights.push(pointLight);
                }
                
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ–≥–Ω–µ–π
                this.animateHolidayLights();
            }

            animateHolidayLights() {
                const animate = () => {
                    if (this.holidayLights && this.holidayLights.length > 0 && this.treeModel) {
                        const time = Date.now() * 0.001;
                        
                        // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ —Ä–∞–∑–º–µ—Ä –µ–ª–∫–∏
                        const treePosition = this.treeModel.position;
                        const treeScale = this.treeModel.scale;
                        
                        // –ë–∞–∑–æ–≤—ã–π —Ä–∞–¥–∏—É—Å –∏ –≤—ã—Å–æ—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–º–µ—Ä–∞ –µ–ª–∫–∏
                        const baseRadius = 1.5;
                        const baseHeight = 0.8;
                        const radius = baseRadius * Math.max(treeScale.x, treeScale.z);
                        const height = baseHeight * treeScale.y;
                        
                        this.holidayLights.forEach((light, index) => {
                            // –ê–Ω–∏–º–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–≥–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã
                            if (this.lightsOn) {
                                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –æ–≥–Ω–∏ –≤–æ–∫—Ä—É–≥ –µ–ª–∫–∏
                                const angle = (index * 15) * Math.PI / 180; // 15 –≥—Ä–∞–¥—É—Å–æ–≤ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö
                                const x = treePosition.x + Math.cos(angle) * radius;
                                const z = treePosition.z + Math.sin(angle) * radius;
                                const y = treePosition.y + height;
                                
                                light.position.set(x, y, z);
                                
                                // –ú–µ—Ä—Ü–∞–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
                                const flicker = Math.sin(time * 3 + index * 2) * 0.3 + 0.7;
                                light.intensity = 1.2 * flicker;
                            }
                        });
                        
                        requestAnimationFrame(animate);
                    }
                };
                animate();
            }

            placeTree(event) {
                if (this.treePlaced) return;
                
                if (!this.treeModel) {
                    this.updateStatus('–ú–æ–¥–µ–ª—å –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...');
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–±–∏–ª—å–Ω–æ–µ –ª–∏ —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
                const isMobile = window.innerWidth < 768;
                const isPortrait = window.innerHeight > window.innerWidth;
                
                let x, y, adjustedZ;
                
                if (isMobile) {
                    // –ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ - —Ä–∞–∑–º–µ—â–∞–µ–º –º–æ–¥–µ–ª—å –≤ —Ü–µ–Ω—Ç—Ä–µ —ç–∫—Ä–∞–Ω–∞
                    x = 0;
                    y = -0.2; // –ù–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ —Ü–µ–Ω—Ç—Ä–∞, —á—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–æ –ª–∏—Ü–æ
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º Z –∏ –º–∞—Å—à—Ç–∞–± —Ç–∞–∫, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –∑–∞–Ω–∏–º–∞–ª–∞ 25% –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞
                    const fov = 75;
                    const fovRadians = (fov * Math.PI) / 180;
                    const desiredHeightPercent = 0.25; // 25% –≤—ã—Å–æ—Ç—ã
                    adjustedZ = -window.innerHeight / (2 * Math.tan(fovRadians / 2)) * desiredHeightPercent * 0.01;
                    
                    // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –º–∞—Å—à—Ç–∞–± –º–æ–¥–µ–ª–∏ –ø–æ–¥ –Ω—É–∂–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                    const targetScale = window.innerHeight * 0.25 / 100; // 25% –æ—Ç –≤—ã—Å–æ—Ç—ã –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö scale
                    this.treeModel.scale.set(targetScale, targetScale, targetScale);
                    
                } else {
                    // –î–µ—Å–∫—Ç–æ–ø - –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, —Ä–∞–∑–º–µ—â–∞–µ–º –≤ —Ç–æ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∫–ª–∏–∫–∞
                    const rect = this.canvas.getBoundingClientRect();
                    const clientX = event.clientX ?? event.touches[0]?.clientX ?? 0;
                    const clientY = event.clientY ?? event.touches[0]?.clientY ?? 0;
                    
                    const normalizedX = ((clientX - rect.left) / rect.width) * 2 - 1;
                    const normalizedY = -((clientY - rect.top) / rect.height) * 2 + 1;
                    
                    // –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞
                    x = normalizedX;
                    y = normalizedY;
                    
                    adjustedZ = -3.5; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Z
                }
                
                this.treeModel.position.set(x, y, adjustedZ);
                
                this.treeModel.visible = true;
                this.treePlaced = true;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                this.animateTreeAppearance();
                
                // –í–∫–ª—é—á–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–µ –æ–≥–Ω–∏
                if (this.holidayLights) {
                    this.holidayLights.forEach(light => {
                        light.visible = true;
                    });
                }

                this.updateStatus('–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è!');
            }

            moveTree(event) {
                if (!this.treePlaced || !this.treeModel) return;

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–±–∏–ª—å–Ω–æ–µ –ª–∏ —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
                const isMobile = window.innerWidth < 768;
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞/—Ç–∞–ø–∞
                const rect = this.canvas.getBoundingClientRect();
                const clientX = event.clientX ?? event.touches[0]?.clientX ?? 0;
                const clientY = event.clientY ?? event.touches[0]?.clientY ?? 0;
                
                // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                const normalizedX = ((clientX - rect.left) / rect.width) * 2 - 1;
                const normalizedY = -((clientY - rect.top) / rect.height) * 2 + 1;
                
                let x, y;
                
                if (isMobile) {
                    // –ú–æ–±–∏–ª—å–Ω—ã–µ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ –∂–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    const isPortrait = window.innerHeight > window.innerWidth;
                    if (isPortrait) {
                        const aspectRatio = window.innerWidth / window.innerHeight;
                        x = normalizedX * 0.8 * aspectRatio;
                        y = normalizedY * 0.8;
                    } else {
                        x = normalizedX * 0.8;
                        y = normalizedY * 0.5;
                    }
                } else {
                    // –î–µ—Å–∫—Ç–æ–ø - –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, —Ç–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    x = normalizedX;
                    y = normalizedY;
                }
                
                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –µ–ª–∫—É –≤ –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
                const adjustedZ = -3.5;
                this.treeModel.position.set(x, y, adjustedZ);
                
                // –û–≥–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ–¥—É—é—Ç –∑–∞ –µ–ª–∫–æ–π –≤ animateHolidayLights()
                
                this.updateStatus('üéÑ –ï–ª–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞!');
            }

            changeTreeSize(delta) {
                if (!this.treePlaced || !this.treeModel) return;

                // –ò–∑–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä –µ–ª–∫–∏
                this.treeModel.scale.x += delta;
                this.treeModel.scale.y += delta;
                this.treeModel.scale.z += delta;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
                const minScale = 0.1;
                const maxScale = 2.0;
                
                this.treeModel.scale.x = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.x));
                this.treeModel.scale.y = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.y));
                this.treeModel.scale.z = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.z));
            }

            animateTreeAppearance() {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–ª–µ–≤–æ–π –º–∞—Å—à—Ç–∞–± –≤–º–µ—Å—Ç–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω–æ–≥–æ 0.3
                const finalScale = this.treeModel.userData?.targetScale ?? this.getAdaptiveScale();
                const startScale = finalScale * 0.33; // –ù–∞—á–∏–Ω–∞–µ–º —Å —Ç—Ä–µ—Ç–∏ —Ü–µ–ª–µ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
                const duration = 1000;
                const startTime = Date.now();

                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    const currentScale = startScale + (finalScale - startScale) * easeOut;
                    
                    this.treeModel.scale.set(currentScale, currentScale, currentScale);
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
                        this.startTreeRotation();
                    }
                };
                
                this.treeModel.scale.set(startScale, startScale, startScale);
                animate();
            }

            startTreeRotation() {
                const animate = () => {
                    if (this.treeModel && this.treeModel.visible) {
                        this.treeModel.rotation.y += 0.01;
                        requestAnimationFrame(animate);
                    }
                };
                animate();
            }

            resetTree() {
                // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å –∏–∑ —Å—Ü–µ–Ω—ã
                if (this.treeModel) {
                    this.scene.remove(this.treeModel);
                    this.treeModel = null;
                }
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –æ–≥–Ω–∏
                if (this.holidayLights && this.holidayLights.length > 0) {
                    this.holidayLights.forEach(light => {
                        this.scene.remove(light);
                    });
                    this.holidayLights = [];
                }
                
                this.treePlaced = false;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é —Å–ª—É—á–∞–π–Ω—É—é –º–æ–¥–µ–ª—å
                this.createTreeFromGLB().then(() => {
                    // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–µ–º –æ–≥–Ω–∏
                    this.createHolidayLights();
                });
                
                this.updateStatus('AR –∞–∫—Ç–∏–≤–µ–Ω');
            }

            toggleHolidayLights() {
                const lightsButton = document.getElementById('lights-button');
                if (!lightsButton) {
                    return;
                }

                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                this.lightsOn = !this.lightsOn;
                
                // –ï—Å–ª–∏ –æ–≥–Ω–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, —É–ø—Ä–∞–≤–ª—è–µ–º –∏–º–∏
                if (this.holidayLights && this.holidayLights.length > 0) {
                    this.holidayLights.forEach((light, index) => {
                        if (this.lightsOn) {
                            // –í–∫–ª—é—á–∞–µ–º –æ–≥–Ω–∏
                            light.intensity = 1.5;
                        } else {
                            // –í—ã–∫–ª—é—á–∞–µ–º –æ–≥–Ω–∏
                            light.intensity = 0;
                        }
                    });
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                if (this.lightsOn) {
                    lightsButton.textContent = 'üí° –û–≥–Ω–∏ –í–ö–õ';
                    lightsButton.style.background = '#4ecdc4';
                    this.updateStatus('üéÑ –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –æ–≥–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã!');
                } else {
                    lightsButton.textContent = 'üí° –û–≥–Ω–∏ –í–´–ö–õ';
                    lightsButton.style.background = '#666';
                    this.updateStatus('üéÑ –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –æ–≥–Ω–∏ –≤—ã–∫–ª—é—á–µ–Ω—ã');
                }
            }


            animate() {
                if (this.renderer && this.scene && this.camera) {
                    this.renderer.render(this.scene, this.camera);
                }
                requestAnimationFrame(() => this.animate());
            }


            // UI –º–µ—Ç–æ–¥—ã
            hideStartButton() {
                const startButton = document.getElementById('start-button');
                if (startButton) {
                    startButton.classList.add('hidden');
                }
            }

            showControlButtons() {
                const resetButton = document.getElementById('reset-button');
                const lightsButton = document.getElementById('lights-button');
                if (resetButton) {
                    resetButton.classList.remove('hidden');
                }
                if (lightsButton) {
                    lightsButton.classList.remove('hidden');
                }
            }

            showStatus(show) {
                const status = document.getElementById('status');
                if (status) {
                    if (show) {
                        status.classList.remove('hidden');
                    } else {
                        status.classList.add('hidden');
                    }
                }
            }

            updateStatus(message) {
                const statusText = document.getElementById('status-text');
                if (statusText) {
                    statusText.textContent = message;
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            new BasicARApp();
        });
    </script>
</body>
</html>
