<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –ï–ª–∫–∞ - –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        #container {
            cursor: pointer;
        }

        #start-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            pointer-events: all;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        #start-button:hover {
            transform: translate(-50%, -50%) scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
        }

        #instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            text-align: center;
            font-size: 14px;
            pointer-events: all;
            max-width: 90%;
            z-index: 10;
        }

        #mobile-instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            text-align: center;
            font-size: 14px;
            pointer-events: all;
            max-width: 90%;
            z-index: 10;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            #instructions {
                display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            }
            
            #mobile-instructions {
                display: block; /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
            }
        }

        .hidden {
            display: none !important;
        }

        #status {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            pointer-events: all;
        }
    </style>
</head>
<body>
    <div id="container">
        <video id="video" autoplay muted playsinline></video>
        <canvas id="canvas"></canvas>
        
        <div id="ui-overlay">
            <button id="start-button">üéÑ –ó–∞–ø—É—Å—Ç–∏—Ç—å AR</button>
            <button id="reset-button" class="hidden" style="position: absolute; top: 20px; right: 20px; background: #ff6b6b; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer;">üîÑ –°–±—Ä–æ—Å</button>
            <button id="lights-button" class="hidden" style="position: absolute; top: 20px; right: 100px; background: #4ecdc4; color: white; border: none; padding: 10px 15px; border-radius: 20px; cursor: pointer;">üí° –û–≥–Ω–∏</button>
            
            <div id="status" class="hidden">
                <div>–°—Ç–∞—Ç—É—Å: <span id="status-text">–ì–æ—Ç–æ–≤</span></div>
            </div>
            
            <div id="instructions">
                <div>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –ø–ª–æ—Å–∫—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å</div>
                <div><strong>–ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞</strong></div>
                <div style="color: #4ecdc4; font-size: 12px; margin-top: 5px;">
                    üí° –ü–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è: –∫–ª–∏–∫ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, –∫–æ–ª–µ—Å–æ –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞, –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ–≥–Ω–µ–π
                </div>
            </div>
            
            <!-- <div id="mobile-instructions" style="display: none;">
                <div>üì∑ –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –ø–ª–æ—Å–∫—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å</div>
                <div>üéØ <strong>–¢–∞–ø–Ω–∏—Ç–µ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –µ–ª–∫–∏</strong></div>
                <div>üîÑ <strong>–¢–∞–ø–Ω–∏—Ç–µ —Å–Ω–æ–≤–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è</strong></div>
                <div>üì± <strong>Pinch-–∂–µ—Å—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞</strong></div>
                <div>üí° <strong>–ö–Ω–æ–ø–∫–∞ "–û–≥–Ω–∏" –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è</strong></div>
                <div>üéÑ –°–ª—É—á–∞–π–Ω–∞—è –º–æ–¥–µ–ª—å –∏–∑ –≤–∞—à–∏—Ö GLB —Ñ–∞–π–ª–æ–≤</div>
                <div style="color: #4ecdc4; font-size: 12px; margin-top: 5px;">
                    üí° –ü–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è: —Ç–∞–ø –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è, pinch –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞, –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ–≥–Ω–µ–π
                </div>
            </div> -->
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- GLTFLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        class BasicARApp {
            constructor() {
                this.video = null;
                this.canvas = null;
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.treeModel = null;
                this.isARActive = false;
                this.treePlaced = false;
                this.lightsOn = true; // –û–≥–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                
                this.init();
            }

            async init() {
                this.video = document.getElementById('video');
                this.canvas = document.getElementById('canvas');
                
                this.setupEventListeners();
                this.updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            }

            setupEventListeners() {
                const startButton = document.getElementById('start-button');
                const resetButton = document.getElementById('reset-button');
                const lightsButton = document.getElementById('lights-button');
                
                if (startButton) {
                    startButton.addEventListener('click', () => {
                        this.startAR();
                    });
                }
                
                if (resetButton) {
                    resetButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Reset button clicked');
                        this.resetTree();
                    });
                }
                
                if (lightsButton) {
                    lightsButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Lights button clicked');
                        this.toggleHolidayLights();
                    });
                }

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –µ–ª–∫–∏
            const container = document.getElementById('container');
            if (container) {
                container.addEventListener('click', (event) => {
                    console.log('–ö–ª–∏–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!', {
                        isARActive: this.isARActive,
                        treePlaced: this.treePlaced,
                        target: event.target.tagName
                    });
                    
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º –∏ –¥—Ä—É–≥–∏–º UI —ç–ª–µ–º–µ–Ω—Ç–∞–º
                    if (event.target.tagName === 'BUTTON' || 
                        event.target.closest('button') || 
                        event.target.closest('#instructions') ||
                        event.target.closest('#mobile-instructions')) {
                        console.log('–ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º');
                        return;
                    }
                    
                    if (this.isARActive) {
                        if (!this.treePlaced) {
                            console.log('–†–∞–∑–º–µ—â–∞–µ–º –µ–ª–∫—É...');
                            this.placeTree(event);
                        } else {
                            console.log('–ü–µ—Ä–µ–º–µ—â–∞–µ–º –µ–ª–∫—É...');
                            this.moveTree(event);
                        }
                    } else {
                        console.log('AR –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω');
                        this.updateStatus('AR –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω');
                    }
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–µ—Å–∞ –º—ã—à–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –µ–ª–∫–∏
                container.addEventListener('wheel', (event) => {
                    if (this.isARActive && this.treePlaced && this.treeModel) {
                        event.preventDefault();
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
                        const delta = event.deltaY > 0 ? -0.1 : 0.1;
                        
                        this.changeTreeSize(delta);
                    }
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∂–µ—Å—Ç–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                let initialDistance = 0;
                let initialScale = 0.3;

                container.addEventListener('touchstart', (event) => {
                    if (this.isARActive && this.treePlaced && this.treeModel && event.touches.length === 2) {
                        event.preventDefault();
                        initialDistance = Math.hypot(
                            event.touches[0].clientX - event.touches[1].clientX,
                            event.touches[0].clientY - event.touches[1].clientY
                        );
                        initialScale = this.treeModel.scale.x;
                    }
                });

                container.addEventListener('touchmove', (event) => {
                    if (this.isARActive && this.treePlaced && this.treeModel && event.touches.length === 2) {
                        event.preventDefault();
                        
                        const currentDistance = Math.hypot(
                            event.touches[0].clientX - event.touches[1].clientX,
                            event.touches[0].clientY - event.touches[1].clientY
                        );
                        
                        const scaleChange = (currentDistance - initialDistance) / 100;
                        const newScale = initialScale + scaleChange;
                        
                        this.treeModel.scale.set(newScale, newScale, newScale);
                        
                        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
                        const minScale = 0.1;
                        const maxScale = 2.0;
                        
                        this.treeModel.scale.x = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.x));
                        this.treeModel.scale.y = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.y));
                        this.treeModel.scale.z = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.z));
                        
                        this.updateStatus(`üéÑ –†–∞–∑–º–µ—Ä –µ–ª–∫–∏: ${(this.treeModel.scale.x * 100).toFixed(0)}%`);
                    }
                });
            }
            }

            async startAR() {
                try {
                    this.updateStatus('–ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã...');
                    
                    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        } 
                    });
                    
                    this.video.srcObject = stream;
                    
                    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ
                    this.video.addEventListener('loadedmetadata', () => {
                        this.setupThreeJS();
                        this.hideStartButton();
                        this.showStatus(true);
                        this.isARActive = true;
                        this.updateStatus('AR –∞–∫—Ç–∏–≤–µ–Ω - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –µ–ª–∫–∏');
                    });
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
                    this.updateStatus('–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ');
                }
            }

            async setupThreeJS() {
                // –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É Three.js
                this.scene = new THREE.Scene();
                
                // –°–æ–∑–¥–∞–µ–º –∫–∞–º–µ—Ä—É
                this.camera = new THREE.PerspectiveCamera(
                    75, 
                    window.innerWidth / window.innerHeight, 
                    0.1, 
                    1000
                );
                
                // –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä
                this.renderer = new THREE.WebGLRenderer({ 
                    canvas: this.canvas,
                    alpha: true,
                    antialias: true
                });
                
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(window.devicePixelRatio);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º GLB –º–æ–¥–µ–ª—å –µ–ª–∫–∏
                await this.createTreeFromGLB();
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Å–≤–µ—â–µ–Ω–∏–µ
                this.setupLighting();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
                this.animate();
            }

            async createTreeFromGLB() {
                return new Promise((resolve, reject) => {
                    // –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö GLB –º–æ–¥–µ–ª–µ–π
                    const availableModels = [
                        'tree.glb',
                        '3december2020__train_set.glb',
                        'christmas_gift_boxs.glb',
                        'christmas_log.glb',
                        'christmas_ornaments.glb',
                        'christmas_present.glb',
                        'new_year_marathon_day_4.glb',
                        'snow_globe.glb',
                        'tree_3december_day_22.glb'
                    ];
                    
                    // –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏
                    const randomModel = availableModels[Math.floor(Math.random() * availableModels.length)];
                    console.log('–í—ã–±—Ä–∞–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –º–æ–¥–µ–ª—å:', randomModel);
                    
                    const loader = new THREE.GLTFLoader();
                    loader.load(
                        `./${randomModel}`,
                        (gltf) => {
                            this.treeModel = gltf.scene;
                            
                            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –º–æ–¥–µ–ª—å
                            this.treeModel.scale.set(0.3, 0.3, 0.3);
                            this.treeModel.visible = false;
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–Ω–∏
                            this.treeModel.traverse((child) => {
                                if (child.isMesh) {
                                    child.castShadow = true;
                                    child.receiveShadow = true;
                                }
                            });
                            
                            // –£–∫—Ä–∞—à–µ–Ω–∏—è —É–∂–µ –µ—Å—Ç—å –≤ GLB –º–æ–¥–µ–ª–∏
                            
                            this.scene.add(this.treeModel);
                            console.log('GLB –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', randomModel);
                            resolve();
                        },
                        (progress) => {
                            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏:', (progress.loaded / progress.total * 100) + '%');
                        },
                        (error) => {
                            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ GLB –º–æ–¥–µ–ª–∏:', error);
                            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –µ–ª–∫—É –∫–∞–∫ fallback
                            this.createSimpleTree();
                            resolve();
                        }
                    );
                });
            }

            createSimpleTree() {
                // –°—Ç–≤–æ–ª –µ–ª–∫–∏ (–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ü–∏–ª–∏–Ω–¥—Ä)
                const trunkGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.5, 8);
                const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.position.y = -0.25;
                
                // –ò–≥–æ–ª–∫–∏ –µ–ª–∫–∏ (–∑–µ–ª–µ–Ω—ã–µ –∫–æ–Ω—É—Å—ã)
                const needlesGeometry = new THREE.ConeGeometry(0.8, 1.5, 8);
                const needlesMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
                const needles = new THREE.Mesh(needlesGeometry, needlesMaterial);
                needles.position.y = 0.5;
                
                // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É –¥–ª—è –µ–ª–∫–∏
                this.treeModel = new THREE.Group();
                this.treeModel.add(trunk);
                this.treeModel.add(needles);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —É–∫—Ä–∞—à–µ–Ω–∏—è (—Ü–≤–µ—Ç–Ω—ã–µ —à–∞—Ä—ã)
                this.addDecorations();
                
                this.scene.add(this.treeModel);
                this.treeModel.visible = false;
            }

            addDecorations() {
                const colors = [0xFF0000, 0x00FF00, 0x0000FF, 0xFFFF00, 0xFF00FF, 0x00FFFF];
                
                for (let i = 0; i < 6; i++) {
                    const ballGeometry = new THREE.SphereGeometry(0.1, 8, 8);
                    const ballMaterial = new THREE.MeshLambertMaterial({ 
                        color: colors[i] 
                    });
                    const ball = new THREE.Mesh(ballGeometry, ballMaterial);
                    
                    // –°–ª—É—á–∞–π–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–∞ –µ–ª–∫–µ
                    ball.position.set(
                        (Math.random() - 0.5) * 1.2,
                        Math.random() * 1.5 - 0.5,
                        (Math.random() - 0.5) * 1.2
                    );
                    
                    this.treeModel.add(ball);
                }
            }

            setupLighting() {
                // –û–∫—Ä—É–∂–∞—é—â–∏–π —Å–≤–µ—Ç
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                this.scene.add(ambientLight);

                // –û—Å–Ω–æ–≤–Ω–æ–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–≤–µ—Ç
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                this.scene.add(directionalLight);

                // –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –æ–≥–Ω–∏ –≤–æ–∫—Ä—É–≥ –µ–ª–∫–∏
                this.createHolidayLights();
            }

            createHolidayLights() {
                // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–≤–µ—Ç–∞ –ø–æ –∫—Ä—É–≥—É —Å —à–∞–≥–æ–º 15 –≥—Ä–∞–¥—É—Å–æ–≤ (24 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
                const numLights = 24; // 360 / 15 = 24 –∏—Å—Ç–æ—á–Ω–∏–∫–∞
                
                // –¶–≤–µ—Ç–∞ –¥–ª—è –æ–≥–Ω–µ–π
                const colors = [
                    0xff4444, // –ö—Ä–∞—Å–Ω—ã–π
                    0xff8844, // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                    0xffff44, // –ñ–µ–ª—Ç—ã–π
                    0x88ff44, // –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π
                    0x44ff44, // –ó–µ–ª–µ–Ω—ã–π
                    0x44ff88, // –ú–æ—Ä—Å–∫–æ–π –≤–æ–ª–Ω—ã
                    0x44ffff, // –ì–æ–ª—É–±–æ–π
                    0x4488ff, // –°–∏–Ω–∏–π
                    0x8844ff, // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
                    0xff44ff, // –†–æ–∑–æ–≤—ã–π
                    0xff4488, // –†–æ–∑–æ–≤–æ-–∫—Ä–∞—Å–Ω—ã–π
                    0xff6666  // –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π
                ];
                
                this.holidayLights = [];

                for (let i = 0; i < numLights; i++) {
                    const color = colors[i % colors.length]; // –¶–∏–∫–ª–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–≤–µ—Ç–∞
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–≤–µ—Ç–∞
                    const pointLight = new THREE.PointLight(color, 1.2, 8);
                    pointLight.visible = false; // –î–µ–ª–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–º
                    pointLight.castShadow = true;
                    this.scene.add(pointLight);
                    this.holidayLights.push(pointLight);
                }
                
                console.log('–ù–µ–≤–∏–¥–∏–º—ã–µ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –æ–≥–Ω–∏ —Å–æ–∑–¥–∞–Ω—ã:', this.holidayLights.length);
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ–≥–Ω–µ–π
                this.animateHolidayLights();
            }

            animateHolidayLights() {
                const animate = () => {
                    if (this.holidayLights && this.holidayLights.length > 0 && this.treeModel) {
                        const time = Date.now() * 0.001;
                        
                        // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ —Ä–∞–∑–º–µ—Ä –µ–ª–∫–∏
                        const treePosition = this.treeModel.position;
                        const treeScale = this.treeModel.scale;
                        
                        // –ë–∞–∑–æ–≤—ã–π —Ä–∞–¥–∏—É—Å –∏ –≤—ã—Å–æ—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–º–µ—Ä–∞ –µ–ª–∫–∏
                        const baseRadius = 1.5;
                        const baseHeight = 0.8;
                        const radius = baseRadius * Math.max(treeScale.x, treeScale.z);
                        const height = baseHeight * treeScale.y;
                        
                        this.holidayLights.forEach((light, index) => {
                            // –ê–Ω–∏–º–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–≥–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã
                            if (this.lightsOn) {
                                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –æ–≥–Ω–∏ –≤–æ–∫—Ä—É–≥ –µ–ª–∫–∏
                                const angle = (index * 15) * Math.PI / 180; // 15 –≥—Ä–∞–¥—É—Å–æ–≤ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö
                                const x = treePosition.x + Math.cos(angle) * radius;
                                const z = treePosition.z + Math.sin(angle) * radius;
                                const y = treePosition.y + height;
                                
                                light.position.set(x, y, z);
                                
                                // –ú–µ—Ä—Ü–∞–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
                                const flicker = Math.sin(time * 3 + index * 2) * 0.3 + 0.7;
                                light.intensity = 1.2 * flicker;
                            }
                        });
                        
                        requestAnimationFrame(animate);
                    }
                };
                animate();
            }

            placeTree(event) {
                if (this.treePlaced) return;

                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞
                const rect = this.canvas.getBoundingClientRect();
                const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

                // –†–∞–∑–º–µ—â–∞–µ–º –µ–ª–∫—É –≤ 3D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ (–Ω–∏–∂–µ –ø–æ Y, —á—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–∞ –ª–∏—Ü–æ)
                this.treeModel.position.set(x * 1.5, y * 1.5 - 1, -2.5);
                this.treeModel.visible = true;
                this.treePlaced = true;

                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                this.animateTreeAppearance();
                
                // –í–∫–ª—é—á–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–µ –æ–≥–Ω–∏
                if (this.holidayLights) {
                    this.holidayLights.forEach(light => {
                        light.visible = true;
                    });
                }

                this.updateStatus('üéÑ –ï–ª–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞! –ö–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                const resetButton = document.getElementById('reset-button');
                const lightsButton = document.getElementById('lights-button');
                if (resetButton) {
                    resetButton.classList.remove('hidden');
                }
                if (lightsButton) {
                    lightsButton.classList.remove('hidden');
                }
            }

            moveTree(event) {
                if (!this.treePlaced || !this.treeModel) return;

                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞
                const rect = this.canvas.getBoundingClientRect();
                const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –µ–ª–∫—É –≤ –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é (–Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–∞ –ª–∏—Ü–æ)
                this.treeModel.position.set(x * 1.5, y * 1.5 - 1, -2.5);
                
                // –û–≥–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ–¥—É—é—Ç –∑–∞ –µ–ª–∫–æ–π –≤ animateHolidayLights()
                
                console.log('–ï–ª–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ –ø–æ–∑–∏—Ü–∏—é:', this.treeModel.position);
                this.updateStatus('üéÑ –ï–ª–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞!');
            }

            changeTreeSize(delta) {
                if (!this.treePlaced || !this.treeModel) return;

                // –ò–∑–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä –µ–ª–∫–∏
                this.treeModel.scale.x += delta;
                this.treeModel.scale.y += delta;
                this.treeModel.scale.z += delta;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä
                const minScale = 0.1;
                const maxScale = 2.0;
                
                this.treeModel.scale.x = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.x));
                this.treeModel.scale.y = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.y));
                this.treeModel.scale.z = Math.max(minScale, Math.min(maxScale, this.treeModel.scale.z));
                
                console.log('–†–∞–∑–º–µ—Ä –µ–ª–∫–∏ –∏–∑–º–µ–Ω–µ–Ω:', this.treeModel.scale.x);
                this.updateStatus(`üéÑ –†–∞–∑–º–µ—Ä –µ–ª–∫–∏: ${(this.treeModel.scale.x * 100).toFixed(0)}%`);
            }

            animateTreeAppearance() {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –º–∞—Å—à—Ç–∞–± –º–æ–¥–µ–ª–∏
                const startScale = 0.1;
                const endScale = 0.3; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Ä–∞–∑–º–µ—Ä—É 0.3
                const duration = 1000;
                const startTime = Date.now();

                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    const easeOut = 1 - Math.pow(1 - progress, 3);
                    const currentScale = startScale + (endScale - startScale) * easeOut;
                    
                    this.treeModel.scale.set(currentScale, currentScale, currentScale);
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
                        this.startTreeRotation();
                    }
                };
                
                this.treeModel.scale.set(startScale, startScale, startScale);
                animate();
            }

            startTreeRotation() {
                const animate = () => {
                    if (this.treeModel && this.treeModel.visible) {
                        this.treeModel.rotation.y += 0.01;
                        requestAnimationFrame(animate);
                    }
                };
                animate();
            }

            resetTree() {
                console.log('=== –§–£–ù–ö–¶–ò–Ø RESET –í–´–ó–í–ê–ù–ê ===');
                
                // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â—É—é –º–æ–¥–µ–ª—å –∏–∑ —Å—Ü–µ–Ω—ã
                if (this.treeModel) {
                    console.log('–£–¥–∞–ª—è–µ–º –º–æ–¥–µ–ª—å –∏–∑ —Å—Ü–µ–Ω—ã');
                    this.scene.remove(this.treeModel);
                    this.treeModel = null;
                } else {
                    console.log('–ú–æ–¥–µ–ª–∏ –Ω–µ—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                }
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –æ–≥–Ω–∏
                if (this.holidayLights && this.holidayLights.length > 0) {
                    console.log('–£–¥–∞–ª—è–µ–º', this.holidayLights.length, '–æ–≥–Ω–µ–π');
                    this.holidayLights.forEach(light => {
                        this.scene.remove(light);
                    });
                    this.holidayLights = [];
                } else {
                    console.log('–û–≥–Ω–µ–π –Ω–µ—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                }
                
                this.treePlaced = false;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é —Å–ª—É—á–∞–π–Ω—É—é –º–æ–¥–µ–ª—å
                console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å...');
                this.createTreeFromGLB();
                
                this.updateStatus('AR –∞–∫—Ç–∏–≤–µ–Ω - –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞');
                console.log('=== –°–ë–†–û–° –ó–ê–í–ï–†–®–ï–ù ===');
            }

            toggleHolidayLights() {
                console.log('=== –§–£–ù–ö–¶–ò–Ø TOGGLE LIGHTS –í–´–ó–í–ê–ù–ê ===');
                
                if (!this.holidayLights || this.holidayLights.length === 0) {
                    console.log('–û–®–ò–ë–ö–ê: –û–≥–Ω–µ–π –Ω–µ—Ç!', this.holidayLights);
                    return;
                }

                const lightsButton = document.getElementById('lights-button');
                if (!lightsButton) {
                    console.log('–û–®–ò–ë–ö–ê: –ö–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                    return;
                }

                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                this.lightsOn = !this.lightsOn;
                console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–≥–Ω–µ–π –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞:', this.lightsOn);
                console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–≥–Ω–µ–π:', this.holidayLights.length);
                
                this.holidayLights.forEach((light, index) => {
                    if (this.lightsOn) {
                        // –í–∫–ª—é—á–∞–µ–º –æ–≥–Ω–∏
                        light.intensity = 1.5;
                    } else {
                        // –í—ã–∫–ª—é—á–∞–µ–º –æ–≥–Ω–∏
                        light.intensity = 0;
                    }
                    console.log(`–û–≥–æ–Ω—å ${index}: intensity = ${light.intensity}`);
                });

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                if (this.lightsOn) {
                    lightsButton.textContent = 'üí° –û–≥–Ω–∏ –í–ö–õ';
                    lightsButton.style.background = '#4ecdc4';
                    this.updateStatus('üéÑ –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –æ–≥–Ω–∏ –≤–∫–ª—é—á–µ–Ω—ã!');
                } else {
                    lightsButton.textContent = 'üí° –û–≥–Ω–∏ –í–´–ö–õ';
                    lightsButton.style.background = '#666';
                    this.updateStatus('üéÑ –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –æ–≥–Ω–∏ –≤—ã–∫–ª—é—á–µ–Ω—ã');
                }

                console.log('=== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û ===');
            }


            animate() {
                if (this.renderer && this.scene && this.camera) {
                    this.renderer.render(this.scene, this.camera);
                }
                requestAnimationFrame(() => this.animate());
            }


            // UI –º–µ—Ç–æ–¥—ã
            hideStartButton() {
                const startButton = document.getElementById('start-button');
                if (startButton) {
                    startButton.classList.add('hidden');
                }
            }

            showStatus(show) {
                const status = document.getElementById('status');
                if (status) {
                    if (show) {
                        status.classList.remove('hidden');
                    } else {
                        status.classList.add('hidden');
                    }
                }
            }

            updateStatus(message) {
                const statusText = document.getElementById('status-text');
                if (statusText) {
                    statusText.textContent = message;
                }
                console.log('–°—Ç–∞—Ç—É—Å:', message);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            new BasicARApp();
        });
    </script>
</body>
</html>
